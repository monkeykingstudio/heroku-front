<h5>Diapause</h5>
<div id="diapauseRef" class="diapause-container animate__animated animate__slideInRight">
  <div [ngClass]="(endDate && diapauseStart && (getTimeDifference() >= 0) && showCountdown) || diapauseLoaded && (getTimeDifference() >= 0) && showCountdown ? 'justify-content-between' : 'justify-content-end'" class="d-flex align-items-center">
    <div *ngIf="(endDate && diapauseStart && (getTimeDifference() >= 0) && showCountdown) || (diapauseLoaded) && (getTimeDifference() >= 0) && showCountdown" class="countDown">
      <span> {{daysToDday}} days, {{hoursToDday}} hours, {{minutesToDday}}m, {{secondsToDday}}s</span>
    </div>
    <button (click)="openPopup('diapausePopup')" class="align-self-end edit-btn" type="button">
      <i class="options-icon"></i>
    </button>
  </div>

  <div class="separator-module"></div>

  <div class="body d-flex flex-column">
    <div class="recommended">
      <h6>recommended period</h6>
      <div class="dates">
        <span>
        {{sheet?.diapausePeriod[0].diapauseStart}} <i>--></i> {{sheet?.diapausePeriod[0].diapauseEnd}}
        </span>
      </div>
    </div>

    <div *ngIf="!diapauseLoaded" class="schedule">
      <form (ngSubmit)='saveDiapause()' [formGroup]="diapauseForm">
        <div class="inner-separator"></div>
        <div *ngIf="!diapauseStart" style="margin: 1rem 0 .5rem 0;" class=" d-flex justify-content-around">
          <div class="form-check">
            <input
            (input)="switchSchedule()"
            type="radio"
            formControlName="schedule"
            class="form-check-input"
            id="autoStart"
            [value]='false'
            />
            <span
            class="form-check-label">Start today</span><span tooltipClass="antslab-tooltip"
            placement="top"
            ngbTooltip="Start a diapause from now" class="info">?</span>
          </div>

          <div class="form-check">
            <input
            [disabled]="schedule"
            (input)="switchSchedule()"
            type="radio"
            formControlName="schedule"
            class="form-check-input"
            id="schedule"
            [value]='true'
            />
            <span class="form-check-label">Schedule</span>
          </div>
        </div>
        <div *ngIf="!diapauseStart" class="inner-separator"></div>

        <div *ngIf="!schedule && !diapauseStart" class="form-row direct-start">
          <div class="form-group col-md-6">
            <label for="">Start date</label>
            <input
            [disabled]='true' [value]="startDate | date:'yyyy-MM-dd, hh:mm'" (input)="startDate=parseDate($event.target.value)" placeholder="{{startDate | date: 'yyyy-MM-dd, hh:mm'}}" class="form-control date-input">
          </div>
          <div class="form-group col-md-6">
            <label for="">End date</label>
            <input
            type="text" min="startDate" placeholder="{{endDate  | date:'yyyy-MM-dd, hh:mm'}}" onfocus="(this.type='datetime-Local')" onblur="(this.type='text')" [value]="endDate | date:'yyyy-MM-dd,hh:mm'" (input)="endDate=parseDate($event.target.value)" class="form-control date-input">
          </div>
        </div>

        <div *ngIf="schedule && !diapauseStart" class="form-row schedule-start">
          <div class="form-group col-md-6">
            <label for="">Start date</label>
            <input
            [value]="startDate | date:'yyyy-MM-dd, hh:mm'" onfocus="(this.type='datetime-Local')" onblur="(this.type='text')" (input)="startDate=parseDate($event.target.value)" placeholder="{{startDate | date: 'yyyy-MM-dd, hh:mm'}}" class="form-control date-input">
          </div>
          <div class="form-group col-md-6">
            <label for="">End date</label>
            <input
            (change)="endDate"
            type="text" placeholder="{{endDate | date:'yyyy-MM-dd, hh:mm'}}" onfocus="(this.type='datetime-Local')" onblur="(this.type='text')" [value]="endDate | date:'yyyy-MM-dd, hh:mm'" (input)="endDate=parseDate($event.target.value)" class="form-control date-input">
          </div>
        </div>
        <span class="animate__animated animate__fadeInDown badge-invalid" *ngIf='!dateCheck'>End date can't be lower than start date, and start date can't be higher than end date!</span>

        <div class="align-items: center; input-group"></div>

        <div *ngIf="!diapauseStart" class="inner-separator"></div>
          <div *ngIf="endDate && diapauseStart" class="line">
            <div style="margin-bottom: 10px;" class="date-cont">
              <span class="title">Started at: </span><span class='start-date'>{{startDate | date:'mediumDate'}}, {{startDate | date:'h:mm'}}</span>
            </div>
            <div class="date-cont">
              <span class="title">Will end at: </span><span class='end-date'>{{endDate | date:'mediumDate'}}, {{endDate | date:'h:mm'}}</span>
            </div>

          </div>
          <div class="line">
            <span>Messor Barbarus colonies currently in diapause : <b>5</b></span>
          </div>
        <div *ngIf="endDate && diapauseStart" class="inner-separator"></div>
        <div [ngClass]="!diapauseStart ? 'margin-1-1' : 'margin-1'" class="d-flex buttons">
          <button [disabled]="!endDate" *ngIf="!diapauseStart" type='submit' class='green-btn w-100'>START DIAPAUSE</button>
          <button (click)="openPopup('abortPopup')" *ngIf="endDate && diapauseStart" type='button' class='red-btn w-100'>ABORT DIAPAUSE</button>
        </div>

      </form>
    </div>

    <div *ngIf="diapauseLoaded" class="schedule">
      <span style="text-align: center">Loaded from database</span>
      <form (ngSubmit)='saveDiapause()' [formGroup]="diapauseForm">
        <div class="inner-separator"></div>



          <div class="line">
            <div style="margin-bottom: 10px;" class="date-cont">
              <span *ngIf="ended && !showCountdown" class="title">Started: </span><span *ngIf="!showCountdown && !ended" class="title">Will start: </span><span *ngIf="showCountdown" class="title">started at: </span><span class='start-date'>{{this.loadedDiapause[0].period.startDate | date: 'mediumDate'}}, {{this.loadedDiapause[0].period.startDate | date:'h:mm'}}</span>
            </div>
            <div class="date-cont">
              <span *ngIf="ended && !showCountdown" class="title">ended: </span><span *ngIf="!showCountdown && !ended" class="title">will end: </span><span *ngIf="showCountdown" class="title">Will end at: </span><span class='end-date'>{{this.loadedDiapause[0].period.endDate | date: 'mediumDate'}}, {{this.loadedDiapause[0].period.endDate | date:'h:mm'}}</span>
            </div>

          </div>

          <div class="inner-separator"></div>

          <div class="line">
            <span>Messor Barbarus colonies currently in diapause : <b>5</b></span>
          </div>
        <div class="inner-separator"></div>
        <div  class="d-flex buttons margin-1-1">
          <button (click)="openPopup('abortPopup')" type='button' class='red-btn w-100'>ABORT DIAPAUSE</button>
        </div>
      </form>
    </div>
  </div>

<!-- -----------
  Options popup
------------ -->
<app-popup [data]="loadedDiapause" class="diapause-popup animate__animated animate__zoomIn" id='diapausePopup'>
  <div class="popup animate__animated animate__bounceInUp animate__delay-05s">
    <h6 style="font-size:2.2rem!important;text-align: left;text-transform:capitalize">Options</h6>
    <form class="form-group options-popup" [formGroup]="diapauseForm" (ngSubmit)='saveOptions(loadedDiapause)'>
      <div class="checkbox-container d-flex flex-column">
        <!-- <label class="parameters-label" > <i class="parameters-icon"></i> Parameters</label> -->
        <div class="d-flex flex-column">

        </div>
      </div>

      <button  type="submit" (click)="closePopup('diapausePopup'); $event.stopPropagation()" class='green-btn mt-4'>SAVE</button>

    </form>
    <button type="button" class='close-popup' (click)="closePopup('diapausePopup'); $event.stopPropagation()">
      <i class="close-icon"></i>
    </button>
  </div>
</app-popup>

<app-popup class="diapause-popup animate__animated animate__zoomIn" id='abortPopup'>
  <div class="popup animate__animated animate__bounceInUp animate__delay-05s">
    <h6 style="font-size:2.2rem!important;text-transform:capitalize">Abort Diapause</h6>
    <div class="popup-body d-flex flex-column">
      <i class="warning-icon"></i>
      <span>You are about to ABORT a running diapause.<span class="alert">All data will be lost.</span><br/>Are you sure ?</span>
      <div class="d-flex w-100 justify-content-around">
        <button type="submit" class="green-btn">YES</button>
        <button (click)="closePopup('abortPopup')" type="button" class="red-btn">NO</button>
      </div>
    </div>
  </div>
</app-popup>

</div>
